<!DOCTYPE html>
<html>
<head>
  <title>QTE Demo</title>
  <style>
    html, body {
      margin:0; padding:0; height:100%; width:100%; overflow:hidden; background:black; font-family:sans-serif;
    }
    video {
      position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:0;
    }
    #prompt {
      position:absolute; top:10%; width:100%; text-align:center; font-size:48px; color:white; z-index:1;
      text-shadow:2px 2px 5px black;
    }
    button {
      font-size:24px; padding:15px 30px; cursor:pointer; z-index:1;
    }
    #fullscreenBtn, #retryBtn {
      position:absolute; bottom:10%; left:50%; transform:translateX(-50%);
    }
    #mobileButtons {
      position:absolute; bottom:20%; width:100%; text-align:center; z-index:1;
      display:none; /* only for mobile */
    }
    .mobileBtn {
      font-size:32px; margin:5px; padding:15px 25px;
    }
  </style>
</head>
<body>
  <video id="vid"><source src="start.mp4" type="video/mp4"></video>
  <div id="prompt"></div>
  <button id="fullscreenBtn">Go Fullscreen to Start</button>
  <button id="retryBtn" style="display:none;">Retry</button>

  <!-- Mobile buttons -->
  <div id="mobileButtons">
    <button class="mobileBtn" data-key="z">Z</button>
    <button class="mobileBtn" data-key="c">C</button>
    <button class="mobileBtn" data-key="x">X</button>
    <button class="mobileBtn" data-key="l">L</button>
    <button class="mobileBtn" data-key="k">K</button>
    <button class="mobileBtn" data-key="v">V</button>
  </div>

  <script>
    const video = document.getElementById("vid");
    const prompt = document.getElementById("prompt");
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    const retryBtn = document.getElementById("retryBtn");
    const mobileButtons = document.getElementById("mobileButtons");

    const sequence = [
      {key:"z", delay:0, pause:10000},  // first key pause 10s
      {key:"c", delay:2000, pause:2000},
      {key:"x", delay:2000, pause:2000},
      {key:"l", delay:5000, pause:2000},
      {key:"z", delay:5000, pause:2000},
      {key:"k", delay:16000, pause:2000},
      {key:"x", delay:12000, pause:2000},
      {key:"v", delay:4000, pause:2000},
      {key:"z", delay:2000, pause:2000},
      {key:"k", delay:4000, pause:2000}
    ];

    let step = 0;
    let active = false;

    // Detect mobile
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    if (isMobile) mobileButtons.style.display = "block";

    function showPrompt() {
      if (step >= sequence.length) return;

      active = true;
      video.pause(); 
      prompt.textContent = "Press " + sequence[step].key.toUpperCase() + "!";

      setTimeout(() => {
        if (active) fail();
      }, sequence[step].pause);
    }

    function fail() {
      active = false;
      prompt.textContent = "Failed!";
      video.src = "fail.mp4";
      video.play();
      retryBtn.style.display = "inline-block";
    }

    function handleKey(key) {
      if (!active) return;
      if (key.toLowerCase() === sequence[step].key) {
        active = false;
        prompt.textContent = "";
        step++;
        video.play();

        if (step < sequence.length) {
          setTimeout(showPrompt, sequence[step].delay);
        }
      } else fail();
    }

    // Keyboard for PC
    document.addEventListener("keydown", e => handleKey(e.key));

    // Mobile buttons
    mobileButtons.querySelectorAll(".mobileBtn").forEach(btn => {
      btn.addEventListener("click", () => handleKey(btn.dataset.key));
    });

    function startGame() {
      step = 0;
      active = false;
      retryBtn.style.display = "none";
      fullscreenBtn.style.display = "none";
      prompt.textContent = "";

      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      } else if (document.documentElement.webkitRequestFullscreen) { 
        document.documentElement.webkitRequestFullscreen();
      } else if (document.documentElement.msRequestFullscreen) { 
        document.documentElement.msRequestFullscreen();
      }

      video.src = "start.mp4";
      video.play();
      setTimeout(showPrompt, sequence[0].delay);
    }

    video.addEventListener("ended", () => {
      if (step >= sequence.length) {
        prompt.textContent = "Success! YOU WON!";
        retryBtn.style.display = "inline-block";
      }
    });

    fullscreenBtn.addEventListener("click", startGame);
    retryBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
